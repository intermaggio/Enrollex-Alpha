#unenroll-modal.modal.hide.fade
  .modal-header
    %a.close{:'data-dismiss' => 'modal'} ×
    %h3 Unenroll
  .modal-body{style: 'text-align:center'}
    = form_tag '', remote: true do
      = hidden_field_tag :user_id
      = text_area_tag :message, '', placeholder: 'Why are you unenrolling? (And if requesting a refund, please explain why.)', style: 'width:400px;height:100px'
  .modal-footer
    = link_to 'Close', 'javascript:void(0)', :'data-dismiss' => 'modal', class: 'btn'
    = link_to 'Unenroll', 'javascript:void(0)', :'data-dismiss' => 'modal', class: 'btn btn-danger', id: 'unenroll'

#destroy-modal.modal.hide.fade
  .modal-header
    %a.close{:'data-dismiss' => 'modal'} ×
    %h3 Sign in
  .modal-body
    Really destroy
    %span>
    ?
  .modal-footer
    = link_to 'Close', 'javascript:void(0)', :'data-dismiss' => 'modal', class: 'btn'
    = link_to 'Destroy', 'javascript:void(0)', :'data-dismiss' => 'modal', class: 'btn btn-danger', id: 'destroy', remote: true

#catalog_header
  %h1 Courses
  #catalog_header_content
    - if current_user && organization.admins.include?(current_user)
      = link_to 'Add new', '/admin/courses', class: 'btn btn-primary'
    = form_tag "/site/search", class: 'form-search', remote: true do
      = text_field_tag :q, '', placeholder: 'search', class: 'search-query'
      = hidden_field_tag :mirai
      = hidden_field_tag :uid
    #previous_container
      Show Past Courses
      = check_box_tag :previous
.tabbable
  %ul.nav.nav-tabs
    %li.active= link_to 'all', '#all', :'data-toggle' => 'tab'
    - if current_user
      %li= link_to 'my enrollments', '#enrollments', :'data-toggle' => 'tab'

  .tab-content#courses
    #all.tab-pane.active= render partial: 'site/course_table'
    - if current_user
      #enrollments.tab-pane
        - if current_user.courses.mirai.first
          %h3= current_user.name
          = render partial: 'site/course_table', locals: { user: current_user }
        - current_user.campers.each do |camper|
          - if camper.courses.mirai.first
            %h3= camper.name
            = render partial: 'site/course_table', locals: { user: camper }

:javascript
  $('#unenroll').click(function(){
    $('#unenroll-modal form').submit()
    $('.course' + $(this).attr('cid') + ':last').fadeOut('slow')
  })
  $('.unenroll').live('click', function(){
    $('#unenroll-modal form').attr('action', '/courses/' + $(this).attr('cid') + '/unenroll')
    $('#unenroll-modal #user_id').val($(this).attr('uid'))
    $('#unenroll').attr('cid', $(this).attr('cid'))
  })
  $('.actions a').tipTip({ delay: 200 })
  $('.form-search').submit(function(){
    if ( $('#enrollments').hasClass('active') ) {
      $('#uid').val('#{current_user && current_user.id}')
    } else {
      $('#uid').val('')
    }
    if ( $('#previous:checked').length > 0 ) {
      $('#mirai').val('false')
    } else {
      $('#mirai').val('true')
    }
  })
  $('.destroy').live('click', function(){
    $('#destroy-modal span').text(' ' + $(this).attr('course'))
    $('#destroy-modal .btn-danger').attr('href', '/courses/' + $(this).attr('cid') + '/' + $(this).attr('lowname') + '/destroy')
  })
  $('#previous').change(function(){
    $('.form-search').submit()
  })
  $('tbody tr > :not(.actions)').live('click', function(){
    window.location = '/courses/' + $(this).parent().attr('cid') + '/' + $(this).parent().attr('lowname')
  })
  $.tablesorter.addParser({
    id: 'dates',
    is: function(s){return false},
    type: 'numeric',
    format: function(s,t,c) {
      return $(c).attr('date')
    }
  })
  $('#all table').tablesorter({
    headers: {
      3: { sorter: 'dates' }
    }
  })
