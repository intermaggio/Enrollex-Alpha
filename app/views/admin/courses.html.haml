#template-modal.modal.hide.fade
  .modal-header
    %a.close{:'data-dismiss' => 'modal'} Ã—
    %h3 Existing Courses
  .modal-body
    - organization.courses.each do |course|
      .controls
        %label.radio= content_tag :input, course.name, type: 'radio', course_id: course.id
  .modal-footer
    = link_to 'Close', 'javascript:void(0)', class: 'btn', :'data-dismiss' => 'modal'
    = link_to 'Choose', 'javascript:void(0)', id: 'template-choose', class: 'btn btn-success', :'data-dismiss' => 'modal'

%h1 Courses
.tabbable
  %ul.nav.nav-tabs{:'data-tabs' => 'tabs'}
    %li.active= link_to 'list', '#list', :'data-toggle' => 'tab'
    %li= link_to 'create', '#create', id: 'create-link', :'data-toggle' => 'tab'

  .tab-content
    #list.tab-pane.active
      %dl
        - courses.each do |course|
          %dt= link_to course.name, course_admin_path(course)
          %dd= '$' + course.price.to_s
          %ul
            - if course.days.first
              - days = course.days.reorder(:date)
              %li #{days.first.date} - #{days.last.date}
    #create.tab-pane
      .row
        .span12
          - if @course
            %ul
            - @course.errors.messages.each do |message|
              %li
                = message.first
                %ul
                  - message.last.each do |reason|
                    %li= reason
          = form_for :course, url: '/courses/create', html: { class: 'form-horizontal' } do |f|
            %fieldset
              %legend{style: 'position:relative'}
                Create
                %div{style: 'position:absolute;top:-3px;left:80px'}= link_to 'Choose template..', '#template-modal', class: 'btn btn-info', :'data-toggle' => 'modal'
              .row{style: 'padding-top: 15px'}
                .span6
                  .control-group
                    %label Name
                    .controls= f.text_field :name, placeholder: 'name', autocomplete: 'off'
                  .control-group
                    %label Description
                    .controls= f.text_area :description, placeholder: 'description', autocomplete: 'off', style: 'height:100px'
                  .control-group
                    %label Price
                    .controls= text_field_tag :price, '', placeholder: 'price', autocomplete: 'off'
                  .control-group
                    %label Upload a Picture
                    .controls= f.file_field :image
                  .control-group
                    %label Status text
                    .controls= f.text_field :status, placeholder: 'status text', autocomplete: 'off'
                  .control-group
                    %label Featured?
                    .controls= f.check_box :featured
                  .control-group
                    %label Instructors
                    .controls
                      - instructors.each do |instructor|
                        %label.checkbox
                          = check_box_tag :"instructors[#{instructor.id}]"
                          = instructor.name
                .span6
                  .control-group
                    %label Address
                    .controls= f.text_field :address, placeholder: 'address', autocomplete: 'off'
                  .control-group
                    %label City
                    .controls= f.text_field :city, placeholder: 'city', autocomplete: 'off'
                  .control-group
                    %label State
                    .controls= f.text_field :state, placeholder: 'state', autocomplete: 'off'
                  .control-group
                    %label Zip
                    .controls= f.text_field :zip, placeholder: 'zip', autocomplete: 'off'
                  .control-group{style: 'position: relative'}
                    = f.select :range_type, options_for_select({:'Age Range' => :age, :'Grade Range' => :grade}), {}, style: 'width: 120px;position: absolute; left: 10px'
                    .controls
                      = f.text_field :start_range, autocomplete: 'off', style: 'display: inline-block; width: 20px'
                      = ' - '
                      = f.text_field :end_range, autocomplete: 'off', style: 'display: inline-block; width: 20px'
                  .control-group
                    %label Suite #
                    .controls= f.text_field :suite, autocomplete: 'off', style: 'width: 20px'
                  .control-group
                    %label Room #
                    .controls= f.text_field :room, autocomplete: 'off', style: 'width: 20px'
                  .control-group
                    %label Important notes
                    .controls= f.text_area :notes, placeholder: 'important notes', autocomplete: 'off', style: 'height: 150px'
              .form-actions= f.submit :submit, class: 'btn btn-success', value: 'Submit'

- if @course
  :javascript
    $(document).ready(function(){
      $('#create-link').click()
    })

:javascript
  $('.field_with_errors input').each(function(){
    $(this).parent().parent().addClass('error')
  })

  $('#template-choose').click(function(){
    var id = $('.radio input:checked').attr('course_id')
    $.post(
      '/courses/' + id + '/template',
      {},
      function(rsp) {
        var fields = ['name', 'description', 'price', 'status', 'featured']
        for (var i=0; i < fields.length; i++) {
          element = $('#course_' + fields[i])
          element.val(rsp[fields[i]])
          if (element.attr('type') == 'checkbox' && rsp[fields[i]]) {
            element.attr('checked', 'true')
          }
        }
      },
      'json'
    )
  })
